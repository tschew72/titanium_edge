<script>
$.getScript("/vendor/tablescript.js");

</script>

            <!--This is where the skillsettingtable will be landed -->
            <table id="skillsettingtable" class="table table-striped table-bordered table-hover">
              <thead>
                <tr>
                   <th class="align-center">Category</th>
                   <th class="align-center">Skill Name</th>
                   <th class="align-center">Skill Rank</th>
                   <th class="align-center"></th>
                </tr>
              </thead>
              <tbody id="aat" >
                  <% @allskills.each do |i| %>  <!--From Skill Summary Class -->
                  <!-- If flag is set to delete, break. and find next record -->
                  <% if @allskills.get(i).status != 0 %>
                 
                  <tr>
                   
                     <td><%= @scmaster.get(i.skillcatid).categoryname %></td> 
                      
                     <td><%= @ssmaster.get(i.skillid).skill_name %> </a></td>
                     
                     <td><a class="skillrank" href="javascript:void(0)" class="editable-click" data-name="skillrank" data-type="select" data-pk="<%= @allskills.get(i).id%>" data-url="/updateskillrank" data-source="[{value: 1, text: 'Basic'}, {value: 2, text: 'Intermediate'}, {value: 3, text: 'Advance'}, {value: 4, text: 'Expert'}]"   data-title="Enter skill rank">  <%= @sr.get(i.skillrank).skillrankname %>
                     </a></td> 

                     
                     <td>

                      <div class="hidden-sm hidden-xs action-buttons">

                          <!-- <a id="skilldel" class="red" href="/deleteskill?id=<%= @allskills.get(i).id %>"> -->
                          <a onclick="delskill(this, <%=i.id%>)" class="red" href="javascript:void(0)">
                            <i class="icon-trash bigger-130"></i>
                             
                          </a>

                      </div>
                     </td>
                  </tr>

                 <% end %>
                  <% end %>
              </tbody>
            </table>



<script type="text/javascript">

 
  $(function() {  //this is the same as $(document).ready(function(){  http://stackoverflow.com/questions/3908724/what-event-does-jquery-function-fire-on
        
       $('.date-picker').datepicker({autoclose:true}).next().on(ace.click_event, function(){
          $(this).prev().focus();
      });
       

        // *** editable avatar *** //
        try {//ie8 throws some harmless exceptions, so let's catch'em
      
          //first let's add a fake appendChild method for Image element for browsers that have a problem with this
          //because editable plugin calls appendChild, and it causes errors on IE at unpredicted points
          try {
            document.createElement('IMG').appendChild(document.createElement('B'));
          } catch(e) {
            Image.prototype.appendChild = function(el){}
          }


      $('#languagetable').editable({
        selector: 'a.languagename'
      });

      $('#languagetable').editable({
        selector: 'a.spokenrank'
      });

      $('#languagetable').editable({
        selector: 'a.writtenrank'
      });


      $('#skilltable').editable({
        selector: 'a.skillrank'
      });

      $('#skilltable').editable({
        selector: 'a.skills'
      });
   


      $('#expectedsalary').editable();
      $('#currentsalary').editable();




      $('#industries').editable({
        
           source: function() {
                return (<%= @industries%>)
              },
        select2: {
           multiple: true
        },
        allowClear: true,
        minimumInputLength: 3,
        mode: 'popup',
        showbuttons: 'bottom'
      });

      $('#locations').editable({
        
           source: function() {
                return (<%= @countries %>)
              },
        select2: {
           multiple: true
        },
        allowClear: true,
        minimumInputLength: 3,
        mode: 'popup',
        showbuttons: 'bottom'
      });


        // $('#skillsettingtable').dataTable( {   //need to include the Ajax source so that I can reload it from anywhere
        //     "scrollY": 200,
        //     "ScrollX": true,
        //     "iDisplayLength": 10,
        //     "order": [[ 0, "desc" ]],
        //     "scrollCollapse": true,
        //     "jQueryUI": true,
        //     "aoColumns": [          
        //         null, null, null,
        //         { "bSortable": false }
        //       ],
        // } );

                     
        $('#languagesettingtable').dataTable( {
            "scrollY": 200,
            "ScrollX": true,
            "iDisplayLength": 10,
            "order": [[ 0, "desc" ]],
            "scrollCollapse": true,
            "jQueryUI": true,
            "aoColumns": [          
                null, null, null,
                { "bSortable": false }
              ]
        } );




      $("#activecheck").on('change', function(){
          $.ajax({
            url: '/updateactive',
            type: 'POST',
            data: {"activeseeker": this.checked, "pk" : <%=@userprofile.id %>},

            success: function(response){
              var data = JSON.parse(response);

              if (data.active){  
                 document.getElementById( 'spr_block' ).style.visibility = 'visible'; 
              } else{
                document.getElementById( 'spr_block' ).style.visibility = 'hidden'; 
              };

          }


          });
              
         
      });

      $("#insgcheck").on('change', function(){
          $.ajax({
            url: '/updateinsgnow',
            type: 'POST',
            data: {"insingaporenow": this.checked, "pk" : <%=@userprofile.id %>}
            
          });
         
      });
      $("#id-date-picker-1").on('change', function(){
          $.ajax({
            url: '/updatedob',
            type: 'POST',
            data: {"dob": this.value, "pk" : <%=@userprofile.id %>}
            
          });
         
      });     

//TSCHEW

  var sources = {
    1: [{"value":20,"text":"Agnitum Outpost"}]
  };  


      $('#skillcat').editable({   
        source: <%= @skillcat %> ,
        success: function(response, newValue) {
           $('#skillname').editable('option', 'source', sources[newValue]);  
           $('#skillname').editable('setValue', null);
  }
      });

      $('#skillname').editable();
      //init editables 
      $('.newskill').editable('option', 'validate', function(v) {
          if(!v) return 'Required field!';
      });
       

      //automatically show next editable
      $('.newskill').on('save.newskill', function(){
          var that = this;
          setTimeout(function() {
              $(that).closest('tr').next().find('.newskill').editable('show');
          }, 200);
      });     


      $('#saveskill-btn').click(function() {
         $('.newskill').editable('submit', { 
             url: '/newskill', 
             ajaxOptions: {
                 dataType: 'json' //assuming json response
             },           
             success: function(data, config) {
                 
                  if(data && data.errors){ 
                       //server-side validation error, response like {"errors": {"username": "username already exist"} }
                       config.error.call(this, data.errors);

                 }   else{

                      $.gritter.add({
                        title: "New Skill added!",
                        text: 'Go ahead to add more skill or close this window',
                        sticky: false,
                        time: '2500',
                        class_name: 'gritter-light gritter-info'
                      });

                      $('.newskill').editable('setValue', null)  //clear values     
                 }       
             },
             error: function(errors) {
                 var msg = '';
                 if(errors && errors.responseText) { //ajax error, errors = xhr object
                     msg = errors.responseText;
                     $.gritter.add({
                        title: "Missing Information",
                        text: msg,
                        sticky: false,
                        time: '3500',
                        class_name: 'gritter-dark gritter-error'
                     });
                 } else { //validation error (client-side or server-side)
                     $.each(errors, function(k, v) { msg += k+": "+v+"<br>"; });
                     $.gritter.add({
                        title: "Missing Information",
                        text: msg,
                        sticky: false,
                        time: '3500',
                        class_name: 'gritter-dark gritter-error'
                     });
                 } 
                 var data = JSON.parse(errors);

             }
         });
      });



      $('#closeskill-btn').click(function() {
          $('.newskill').editable('setValue', null)  //clear values
              .editable('option', 'pk', null)          //clear pk
              .removeClass('editable-unsaved');        //remove bold css
          
          $("#st").load("/settings #st");   
          //location.reload();
          $('#save-btn').show();
          $('#msg').hide();                
      });



  });


</script>


  
<script>





</script>