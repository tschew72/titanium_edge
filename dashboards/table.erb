


<div class="breadcrumbs" id="breadcrumbs">
  <script type="text/javascript">
    try{ace.settings.check('breadcrumbs' , 'fixed')}catch(e){}
  </script>

  <ul class="breadcrumb">
    <li>
      <i class="ace-icon fa fa-home home-icon"></i>
      <a href="/edge">Home</a>
    </li>
    <li class="active">My Setup</li>
  </ul><!-- /.breadcrumb -->

</div>

<div class="page-content">

     <!-- <div class="row"> -->
     <h3 class="header smaller lighter blue">My Setup</h3>
 
    <div class="col-xs-12">
               
          <div class="row">  <!-- 1st row in the Preference Management section -->
            <div class="col-sm-12"> 
                <div class="form-group">
                     I am active in looking for job <label><input id="activecheck" name="activeseeker" class="ace ace-switch ace-switch-5 btn-rotate" type="checkbox" <%= @userprofile.activeseeker.to_s == "true" ? "checked" : "unchecked" %> /><span class="lbl"></span></label>    
                </div> 
            </div>
          </div>
        
          <div class="row" id="spr_block" style="visibility: hidden">  <!-- 2nd row in the Preference Management section -->
            <div class="col-sm-12">
              <div class="form-group">          
                    I am in Singapore <label><input id="insgcheck" name="insingaporenow" class="ace ace-switch ace-switch-5 btn-rotate" type="checkbox" <%= @userprofile.insingaporenow.to_s == "true" ? "checked" : "unchecked" %> /><span class="lbl"></span></label>    
                    on these dates <label><input type="text" style="width: 200px;" name="date-range-picker" id="id-date-range-picker-1"  class="form-control" value="<%=@userprofile.insg_start.strftime("%d/%m/%Y") %> - <%=@userprofile.insg_end.strftime("%d/%m/%Y") %> "  class="span4"></input></label>
                    <!-- Infobox: If you are in Singapore, and there is seminar or related IT events, we will notify you -->
              </div>      
            </div>
          </div>
        
        <div class="well well-lg">
            <div class="row">  <!-- 5th row in the Preference Management section -->  
              <div class="col-sm-5"> 
                  <h4 class="header smaller lighter blue">Preferred Job Levels </h4>
              </div>
              <div class="col-sm-5"> 
                  <h4 class="header smaller lighter blue">Preferred Job Functions </h4>
              </div>
              <div class="col-sm-2"></div>
            </div>

            <div class="row">
              <div class="col-sm-5"> 
                  <a href="#" id="joblevel" data-type="select2" data-value="<%= @pref_ind %>"  data-pk="<%=@userprofile.id %>" data-url="/updateindpref" data-title="Enter preferred job levels"></a> 
              </div>
              <div class="col-sm-5">   
                   <a href="#" id="jobfunction" data-type="select2" data-value="<%= @pref_loc %>"  data-pk="<%=@userprofile.id %>" data-url="/updatelocpref" data-title="Enter preferred job functions"></a>
              </div>
              <div class="col-sm-2"></div>
            </div>
            <br>
        
            <div class="row">  <!-- 5th row in the Preference Management section -->  
              <div class="col-sm-5"> 
                  <h4 class="header smaller lighter blue">Preferred Industries </h4>
              </div>
              <div class="col-sm-5"> 
                  <h4 class="header smaller lighter blue">Preferred Locations </h4>
              </div>
              <div class="col-sm-2"></div>
            </div>
            <div class="row ">
              <div class="col-sm-5"> 
                  <a href="#" id="industries" data-type="select2" data-value="<%= @pref_ind %>"  data-pk="<%=@userprofile.id %>" data-url="/updateindpref" data-title="Enter preferred industries"></a> 
              </div>
              <div class="col-sm-5">   
                   <a href="#" id="locations" data-type="select2" data-value="<%= @pref_loc %>"  data-pk="<%=@userprofile.id %>" data-url="/updatelocpref" data-title="Enter preferred locations"></a>
              </div>
              <div class="col-sm-2"></div>
            </div>
        </div>
        <br>  
        <div class="row">  <!-- 5th row in the Preference Management section -->  
          <div class="col-sm-2"> 
              <div class="form-group">
                  Current salary: S$ <a href="#" id="currentsalary" data-name="currentsalary" data-type="text" data-pk="<%=@userprofile.id %>" data-url="/updateprofile" data-title="Enter current salary"><%= @userprofile.currentsalary %></a>
              </div> 
          </div>
          <div class="col-sm-2"> 
              <div class="form-group">
                  Expected salary: S$ <a href="#" id="expectedsalary" data-name="expectedsalary" data-type="text"  data-pk="<%=@userprofile.id %>" data-url="/updateprofile" data-title="Enter expected salary"><%= @userprofile.expectedsalary %></a>
              </div> 
          </div>
          <div class="col-sm-8"> </div> 
        </div>
        <div class="row">  <!-- 5th row in the Preference Management section -->   
          <div class="col-sm-6">    
             
                  Preferred Travel Frequency %: <label><input type="text" class="input-mini" id="spinner2" value="<%=@userprofile.travelfreq %>" /></label>        
             
          </div>
        </div>        
         <br><br>
           <div class="row">
            <div class="col-sm-6">  
             Upload new CV
            </div>
           </div>
  </div> <!-- col -->

 
   <div class="row">
      <div class="col-sm-6 ">
      <h3 class="header smaller lighter blue">Skills Management</h3>
      <div id="skilltable">
          
          <div class="action-buttons">

              <a class="red" href="#addskillmodal" data-toggle="modal"> <!-- Set a flag to say it is deleted.  -->
                <i class="icon-pencil bigger-130">Add a skill</i>
              </a>
          </div>          

                  <!--  Modal -->
           <div class="modal fade" id="addskillmodal" >
             <div class="modal-dialog">
               <div class="modal-content">
                  <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                        <h4 class="modal-title">Add new skill</h4>                                                               
                  </div> <!-- "modal-header" -->
                      <div class="modal-body" style="padding-left:45px;">      

                         <div style="width: 40%">
                              <div id="msg" class="alert hide"></div>
                              <table id="user" class="table table-bordered table-striped">
                                  <tbody> 
                                      <tr>         
                                          <td width="100%">Skill category</td> <!--TSCHEW-->
                                          <td width="100%">
                                            <a href="#" class="newskill" data-emptytext="Select..." data-type="select" id="skillcat" data-name="skillcatid"  data-original-title="Select skill category"></a>

                                          <!--   <a href="#" class="newskill" id="skillcat" data-type"select" data-emptytext="Select..." data-name="skillcatid" data-original-title="Select skill category"></a></td> -->
                                      </tr>
                                      <tr>         
                                          <td width="100%">Skill name</td>
                                          <td width="100%"><a href="#" class="newskill" id="skillname"  data-emptytext="Select..." data-type="select" data-name="skillid" data-original-title="Select skill"></a></td>
                                      </tr>  
                                      <tr>         
                                          <td width="100%">Skill rank</td>
                                          <td width="100%"><a href="#" class="newskill" data-emptytext="Select..." data-type="select" data-name="skillrank" data-source="[{value: 1, text: 'Basic'}, {value: 2, text: 'Intermediate'}, {value: 3, text: 'Advance'}, {value: 4, text: 'Expert'}]" data-original-title="Select rank"></a></td>
                                      </tr>     
                                  </tbody>
                              </table>

                              <div>
                              <button id="saveskill-btn" class="btn btn-primary">Save and add new</button>
                              </div>
                              Suggest new skill if yours is not listed here
                          </div>                            

                      </div> <!-- "modal-body" -->
                      <div class="modal-footer">
                           <!-- <input type="submit" name="save" formaction="/jobupdate" value="Submit" /> -->
                           <button type="button" class="btn btn-default" id="closeskill-btn" data-dismiss="modal">Close</button>
                      </div> <!-- footer -->
               </div> <!-- modal-content -->
             </div><!-- modal-dialog -->
           </div><!-- modal  -->    

           <div id="st" onchange="initDataTables1()">
            <!--This is where the skillsettingtable will be landed -->
            <table id="skillsettingtable" class="table table-striped table-bordered table-hover">
              <thead>
                <tr>
                   <th class="align-center">Category</th>
                   <th class="align-center">Skill Name</th>
                   <th class="align-center">Skill Rank</th>
                   <th class="align-center"></th>
                </tr>
              </thead>
              <tbody id="aat" >
                  <% @allskills.each do |i| %>  <!--From Skill Summary Class -->
                  <!-- If flag is set to delete, break. and find next record -->
                  <% if @allskills.get(i).status != 0 %>
                 
                  <tr>
                   
                     <td><%= @scmaster.get(i.skillcatid).categoryname %></td> 
                      
                     <td><%= @ssmaster.get(i.skillid).skill_name %> </a></td>
                     
                     <td><a class="skillrank" href="javascript:void(0)" class="editable-click" data-name="skillrank" data-type="select" data-pk="<%= @allskills.get(i).id%>" data-url="/updateskillrank" data-source="[{value: 1, text: 'Basic'}, {value: 2, text: 'Intermediate'}, {value: 3, text: 'Advance'}, {value: 4, text: 'Expert'}]"   data-title="Enter skill rank">  <%= @sr.get(i.skillrank).skillrankname %>
                     </a></td> 

                     
                     <td>

                      <div class="hidden-sm hidden-xs action-buttons">

                          <!-- <a id="skilldel" class="red" href="/deleteskill?id=<%= @allskills.get(i).id %>"> -->
                          <a onclick="delskill(this, <%=i.id%>)" class="red" href="javascript:void(0)">
                            <i class="icon-trash bigger-130"></i>
                             
                          </a>

                      </div>
                     </td>
                  </tr>

                 <% end %>
                  <% end %>
              </tbody>
            </table>
           </div> <!-- id="st"-->

          
      
        <br><br>


        </div> <!-- skilltable" -->
      </div> <!-- "col-sm-6 column" -->
      <div class="col-sm-6 column">
        <h3 class="header smaller lighter blue">Languages</h3>
        <div id="skilltable">
          
          <div class="action-buttons">

              <a class="red" href="#addlanguagemodal" data-toggle="modal"> <!-- Set a flag to say it is deleted.  -->
                <i class="icon-pencil bigger-130">Add a language</i>
              </a>
              <a class="red" href="#addlanguagemodal" data-toggle="modal"> <!-- Set a flag to say it is deleted.  -->
                <i class="icon-pencil bigger-130">Report new language</i>
              </a>
          </div>          

                  <!--  Modal -->
           <div class="modal fade" id="addlanguagemodal" >
             <div class="modal-dialog">
               <div class="modal-content">
                  <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                        <h4 class="modal-title">Add new language</h4>                                                               
                  </div> <!-- "modal-header" -->
                      <div class="modal-body" style="padding-left:45px;">      

                          <!--- TBA -->






                      </div> <!-- "modal-body" -->
                      <div class="modal-footer">
                           <!-- <input type="submit" name="save" formaction="/jobupdate" value="Submit" /> -->
                           <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                           <button type="button" class="btn btn-default">Add</button>
                      </div> <!-- footer -->
               </div> <!-- modal-content -->
             </div><!-- modal-dialog -->
           </div><!-- modal  -->    


          <table id="languagesettingtable" class="table table-striped table-bordered table-hover">
              <thead>
                <tr>
                   <th class="align-center">Language</th>
                   <th class="align-center">Written Proficiency</th>
                   <th class="align-center">Spoken Proficiency</th>
                   <th class="align-center"></th>
                </tr>
              </thead>
              <tbody>
                  <% @languages.each do |i| %>
                  <!-- If flag is set to delete, break. and find next record -->
                  <% if @languages.get(i).status != 0 %>
                 
                  <tr>
                   
                     <td><a class="languagename" href="javascript:void(0)" class="editable-click" data-name="languageid" data-type="text" data-pk="<%= @languages.get(i).id%>" data-url="/update_language"  data-title="Enter skill category "><%= @lmaster.get(languageid).languagename %></a></td> 
                      
                    <td><a class="writtenrank" href="javascript:void(0)" class="editable-click" data-name="writtenrank" data-type="select" data-pk="<%= @languages.get(i).id%>" data-url="/update_language" data-source="[{value: 1, text: 'Basic'}, {value: 2, text: 'Intermediate'}, {value: 3, text: 'Advance'}, {value: 4, text: 'Expert'}]"   data-title="Enter skill rank">  <%= @sr.get(i.writtenrank).skillrankname %>
                     </a></td> 
                     
                     <td><a class="spokenrank" href="javascript:void(0)" class="editable-click" data-name="spokenrank" data-type="select" data-pk="<%= @languages.get(i).id%>" data-url="/update_language" data-source="[{value: 1, text: 'Basic'}, {value: 2, text: 'Intermediate'}, {value: 3, text: 'Advance'}, {value: 4, text: 'Expert'}]"   data-title="Enter skill rank">  <%= @sr.get(i.spokenrank).skillrankname %>
                     </a></td> 
                     <td>

                      <div class="hidden-sm hidden-xs action-buttons">
                          <a onclick="del_language(this, <%=i.id%>)" class="red" href="javascript:void(0)">
                            <i class="icon-trash bigger-130"></i>
                             
                          </a>

                      </div>
                     </td>
                  </tr>

                 <% end %>
                  <% end %>
              </tbody>
            </table>

      </div> <!-- skill table -->
    </div> <!-- "col-sm-6 column" -->
   </div> <!-- row -->
   
<!-- 11: <%=@sst11%>, 12: <%=@sst12%>, 13: <%=@sst13%>, 14: <%=@sst14%>, 15: <%=@sst15%>, 16: <%=@sst16%>, 17: <%=@sst17%>, 18: <%=@sst18%>, 19: <%=@sst19%>, 20: <%=@sst20%> -->

            
</div>
      
 </div> <!--"page-content" -->                





<script type="text/javascript">

 
  $(function() {  //this is the same as $(document).ready(function(){  http://stackoverflow.com/questions/3908724/what-event-does-jquery-function-fire-on
        
       $('.date-picker').datepicker({autoclose:true}).next().on(ace.click_event, function(){
          $(this).prev().focus();
      });
       

        // *** editable avatar *** //
        try {//ie8 throws some harmless exceptions, so let's catch'em
      
          //first let's add a fake appendChild method for Image element for browsers that have a problem with this
          //because editable plugin calls appendChild, and it causes errors on IE at unpredicted points
          try {
            document.createElement('IMG').appendChild(document.createElement('B'));
          } catch(e) {
            Image.prototype.appendChild = function(el){}
          }


      $('#languagetable').editable({
        selector: 'a.languagename'
      });

      $('#languagetable').editable({
        selector: 'a.spokenrank'
      });

      $('#languagetable').editable({
        selector: 'a.writtenrank'
      });


      $('#skilltable').editable({
        selector: 'a.skillrank'
      });

      $('#skilltable').editable({
        selector: 'a.skills'
      });
   


      $('#expectedsalary').editable();
      $('#currentsalary').editable();




      $('#industries').editable({
        
           source: function() {
                return (<%= @industries%>)
              },
        select2: {
           multiple: true
        },
        allowClear: true,
        minimumInputLength: 3,
        mode: 'popup',
        showbuttons: 'bottom'
      });

      $('#locations').editable({
        
           source: function() {
                return (<%= @countries %>)
              },
        select2: {
           multiple: true
        },
        allowClear: true,
        minimumInputLength: 3,
        mode: 'popup',
        showbuttons: 'bottom'
      });


        // $('#skillsettingtable').dataTable( {   //need to include the Ajax source so that I can reload it from anywhere
        //     "scrollY": 200,
        //     "ScrollX": true,
        //     "iDisplayLength": 10,
        //     "order": [[ 0, "desc" ]],
        //     "scrollCollapse": true,
        //     "jQueryUI": true,
        //     "aoColumns": [          
        //         null, null, null,
        //         { "bSortable": false }
        //       ],
        // } );

                     
        $('#languagesettingtable').dataTable( {
            "scrollY": 200,
            "ScrollX": true,
            "iDisplayLength": 10,
            "order": [[ 0, "desc" ]],
            "scrollCollapse": true,
            "jQueryUI": true,
            "aoColumns": [          
                null, null, null,
                { "bSortable": false }
              ]
        } );




      $("#activecheck").on('change', function(){
          $.ajax({
            url: '/updateactive',
            type: 'POST',
            data: {"activeseeker": this.checked, "pk" : <%=@userprofile.id %>},

            success: function(response){
              var data = JSON.parse(response);

              if (data.active){  
                 document.getElementById( 'spr_block' ).style.visibility = 'visible'; 
              } else{
                document.getElementById( 'spr_block' ).style.visibility = 'hidden'; 
              };

          }


          });
              
         
      });

      $("#insgcheck").on('change', function(){
          $.ajax({
            url: '/updateinsgnow',
            type: 'POST',
            data: {"insingaporenow": this.checked, "pk" : <%=@userprofile.id %>}
            
          });
         
      });
      $("#id-date-picker-1").on('change', function(){
          $.ajax({
            url: '/updatedob',
            type: 'POST',
            data: {"dob": this.value, "pk" : <%=@userprofile.id %>}
            
          });
         
      });     

//TSCHEW

  var sources = {
    1: [{"value":20,"text":"Agnitum Outpost"}]
  };  


      $('#skillcat').editable({   
        source: <%= @skillcat %> ,
        success: function(response, newValue) {
           $('#skillname').editable('option', 'source', sources[newValue]);  
           $('#skillname').editable('setValue', null);
  }
      });

      $('#skillname').editable();
      //init editables 
      $('.newskill').editable('option', 'validate', function(v) {
          if(!v) return 'Required field!';
      });
       

      //automatically show next editable
      $('.newskill').on('save.newskill', function(){
          var that = this;
          setTimeout(function() {
              $(that).closest('tr').next().find('.newskill').editable('show');
          }, 200);
      });     


      $('#saveskill-btn').click(function() {
         $('.newskill').editable('submit', { 
             url: '/newskill', 
             ajaxOptions: {
                 dataType: 'json' //assuming json response
             },           
             success: function(data, config) {
                 
                  if(data && data.errors){ 
                       //server-side validation error, response like {"errors": {"username": "username already exist"} }
                       config.error.call(this, data.errors);

                 }   else{

                      $.gritter.add({
                        title: "New Skill added!",
                        text: 'Go ahead to add more skill or close this window',
                        sticky: false,
                        time: '2500',
                        class_name: 'gritter-light gritter-info'
                      });

                      $('.newskill').editable('setValue', null)  //clear values     
                 }       
             },
             error: function(errors) {
                 var msg = '';
                 if(errors && errors.responseText) { //ajax error, errors = xhr object
                     msg = errors.responseText;
                     $.gritter.add({
                        title: "Missing Information",
                        text: msg,
                        sticky: false,
                        time: '3500',
                        class_name: 'gritter-dark gritter-error'
                     });
                 } else { //validation error (client-side or server-side)
                     $.each(errors, function(k, v) { msg += k+": "+v+"<br>"; });
                     $.gritter.add({
                        title: "Missing Information",
                        text: msg,
                        sticky: false,
                        time: '3500',
                        class_name: 'gritter-dark gritter-error'
                     });
                 } 
                 var data = JSON.parse(errors);

             }
         });
      });



      $('#closeskill-btn').click(function() {
          $('.newskill').editable('setValue', null)  //clear values
              .editable('option', 'pk', null)          //clear pk
              .removeClass('editable-unsaved');        //remove bold css
          
          $("#st").load("/settings #st");   
          //location.reload();
          $('#save-btn').show();
          $('#msg').hide();                
      });



  });


</script>


  
<script>


function initDataTables1(){
            $('#skillsettingtable').dataTable( {   //need to include the Ajax source so that I can reload it from anywhere
                "scrollY": 200,
                "ScrollX": true,
                "iDisplayLength": 10,
                "order": [[ 0, "desc" ]],
                "scrollCollapse": true,
                "jQueryUI": true,
                "aoColumns": [          
                    null, null, null,
                    { "bSortable": false }
                  ],
            });
  }


  $(function() {  //this is the same as $(document).ready(function(){  http://stackoverflow.com/questions/3908724/what-event-does-jquery-function-fire-on
          
            initDataTables1();
  });






</script>