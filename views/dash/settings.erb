<!-- force reload of the page when someone return back to this page from another page -->
<input type="hidden" id="refreshed" value="no">
<script type="text/javascript">
onload=function(){
var e=document.getElementById("refreshed");
if(e.value=="no")e.value="yes";
else{e.value="no";location.reload();}
}
</script>


<div class="content-wrapper main-content-toggle-left"> 
      <!--Content Wrapper-->
    <div class="col-xs-12 col-md-10 col-lg-10">
       <h3 class="header smaller lighter blue">User Preferences</h3>
       <div id="alert_placeholder-tab"> </div>
       <br>
       <br>
       <div class="tabbable">
            <ul class="nav nav-tabs" id="myTab">
              <li class="active">
                <a data-toggle="tab" href="#t1">
                  <i class="green icon-home bigger-110"></i>
                  Home
                </a>
              </li>
              <li>
                <a data-toggle="tab" href="#t3">
                  Preferred Jobs
                </a>
              </li>
              <li>
                <a data-toggle="tab" href="#t4">
                  Preferred Industries
                </a>
              </li>
              <li>
                <a data-toggle="tab" href="#loc">
                  Preferred Locations
                </a>
              </li>                       
              <li>
                <a data-toggle="tab" href="#t5">
                  Salary
                </a>
              </li>
              <li>
                <a data-toggle="tab" href="#t6">
                  Preferred Travel Frequency
                </a>
              </li>
              <li>
                <a data-toggle="tab" href="#skilltab">
                  Skills
                </a>
              </li>
              <li>
                <a data-toggle="tab" href="#languagetab">
                  Languages
                </a>
              </li>
              <li>
                <a data-toggle="tab" href="#t7">
                  Upload CV
                </a>
              </li>                        
            </ul>

      
       <div class="tab-content">
          <div id="t1" class="tab-pane in active">
            <div class="row">  
              <div class="col-sm-12">
                  <div class="orb-form">
                    <div class="col col-4">
                      <label class="toggle"><input id="activecheck" name="activeseeker" type="checkbox" <%= @userprofile.activeseeker.to_s == "true" ? "checked" : "unchecked" %> ><i></i>I am active in looking for job</label>
                      <script>
                              $("#activecheck").on('change', function(){
                                $.ajax({
                                  url: '/updateactive',
                                  type: 'POST',
                                  data: {"activeseeker": this.checked, "pk" : <%=@userprofile.id %>},

                                  success: function(response){
                                    var data = JSON.parse(response);

                                    if (data.active){
                                       if (!data.singaporepr)
                                        {document.getElementById( 'spr_block' ).style.visibility = 'visible';}
                                       if (!data.singaporepr && data.insingaporenow){
                                          document.getElementById( 'insg_block' ).style.visibility = 'visible';}
                                     newAlert("#alert_placeholder-tab", 'success', "Thanks for informing us that you are actively seeker for job");                 
                                    } else{
                                       document.getElementById( 'spr_block' ).style.visibility = 'hidden';
                                       document.getElementById( 'insg_block' ).style.visibility = 'hidden';
                                       newAlert("#alert_placeholder-tab", 'success', "Thanks for informing us that you are not actively looking for job now.");
                                       
                                    }; //else
                                  } //success function
                                }); //ajax
                            }); //activecheck function
                      </script>
                    </div>
                    <span class="tooltip-success" data-rel="tooltip" data-placement="right" title="If you do not wish to be matched for jobs during this period, please swtich it off"><i class="icon-info-sign"></i></span>
                  </div>
              </div>
            </div>
            <div class="row" id="spr_block" style="visibility: hidden">  
              <div class="col-sm-12">
                <div class="form-group">
                      <label class="toggle"><input id="insgcheck" name="insingaporenow" type="checkbox" <%= @userprofile.insingaporenow.to_s == "true" ? "checked" : "unchecked" %>><i></i>I am in Singapore</label>
                      <script>

                          $("#insgcheck").on('change', function(){
                              $.ajax({
                                url: '/updateinsgnow',
                                type: 'POST',
                                data: {"insingaporenow": this.checked, "pk" : <%=@userprofile.id %>},
                                success: function(response){
                                  var data = JSON.parse(response);

                                  if (data.insingaporenow){
                                     document.getElementById( 'insg_block' ).style.visibility = 'visible';
                                     newAlert("#alert_placeholder-tab", 'success', "Welcome to Singapore!");             
                                               
                                  } else{
                                     document.getElementById( 'insg_block' ).style.visibility = 'hidden';
                                     newAlert("#alert_placeholder-tab", 'success', "Look forward to see you in Singapore soon!");
                                                   
                                  }; //else
                                } //success function

                              
                              });
                          });


                      </script>

                      <!-- <label><input id="insgcheck" name="insingaporenow" class="ace ace-switch ace-switch-5 btn-rotate" type="checkbox" <%= @userprofile.insingaporenow.to_s == "true" ? "checked" : "unchecked" %> /><span class="lbl"></span></label> -->
                      <span id="insg_block" style="visibility: hidden">  
                          on these dates <label><input readonly="true" type="text" style="width: 200px;" name="date-range-picker" id="id-date-range-picker-1"  class="form-control rdonly" value="<%=@userprofile.insg_start.strftime("%d/%m/%Y") %> - <%=@userprofile.insg_end.strftime("%d/%m/%Y") %> "  class="span4"></input></label> <span class="tooltip-success" data-rel="tooltip" data-placement="right" title="Higher priorty will be given to job seekers who are currently in Singapore. Employers prefer candidates to be available for interviews. However, for certain jobs, this may not impact your chances as phone interviews are also common place these days. You will also be informed by us if there are any suitable courses, seminars or special events that you should attend to increase your career score"><i class="icon-info-sign"></i></span>
                      </span> 
                </div>    
              </div>
            </div>
          </div> <!-- tab -->
        <div id="t3" class="tab-pane">    
                  <div class="row">  <!-- 5th row in the Preference Management section -->

                    <div class="col-sm-5">
                        <h4 class="header smaller lighter blue">Preferred Job Levels </h4>
                    </div>
                    <div class="col-sm-5">
                        <h4 class="header smaller lighter blue">Preferred Job Functions </h4>
                    </div>
                    <div class="col-sm-2"></div>
                  </div>

                  <div class="row">
                    <div class="col-sm-10">
                        <a href="#" id="joblevel" data-type="select2" data-value="<%= @pref_ind %>"  data-pk="<%=@userprofile.id %>" data-url="/updateindpref" data-title="Enter preferred job levels"></a>
                    </div>
                    <div class="col-sm-10"> 
                         <a href="#" id="jobfunction" data-type="select2" data-value="<%= @pref_loc %>"  data-pk="<%=@userprofile.id %>" data-url="/updatelocpref" data-title="Enter preferred job functions"></a>
                    </div>
                    <div class="col-sm-2"></div>
                  </div>

                  <div class="row">
                    <div class="col-sm-12 col-xs-12">
                      <h4 class="header smaller lighter blue">Other Parameters </h4>
                    </div>
                    <div class="col-sm-3">
                        Full Time   
                    </div>
                    <div class="col-sm-3">        
                        <label><input id="fulltimecheck" name="fulltime" class="ace ace-switch ace-switch-5 btn-rotate" type="checkbox" <%= @userprofile.fulltime.to_s == "true" ? "checked" : "unchecked" %> /><span class="lbl"></span></label><span class="tooltip-success" data-rel="tooltip" data-placement="right" title="Are you looking for full time job?"><i class="icon-info-sign"></i></span>
                    </div>
                    <div class="col-sm-6"> </div>
                  </div>
                  <div class="row">
                    <div class="col-sm-3">
                        Part Time   
                    </div>
                    <div class="col-sm-3">
                        <label><input id="parttimecheck" name="parttime" class="ace ace-switch ace-switch-5 btn-rotate" type="checkbox" <%= @userprofile.parttime.to_s == "true" ? "checked" : "unchecked" %> /><span class="lbl"></span></label><span class="tooltip-success" data-rel="tooltip" data-placement="right" title="Are you looking for part time jobs"><i class="icon-info-sign"></i></span>
                    </div>
                    <div class="col-sm-6"> </div>
                  </div>
                  <div class="row">
                    <div class="col-sm-3">
                        Shift Work
                    </div>
                    <div class="col-sm-3">       
                        <label><input id="shiftworkcheck" name="shiftwork" class="ace ace-switch ace-switch-5 btn-rotate" type="checkbox" <%= @userprofile.shiftwork.to_s == "true" ? "checked" : "unchecked" %> /><span class="lbl"></span></label>  <span class="tooltip-success" data-rel="tooltip" data-placement="right" title="Can we match you to jobs that require you to work on shifts?"><i class="icon-info-sign"></i></span>
                    </div>
                    <div class="col-sm-6"> </div>
                  </div>

                  <div class="row">
                    <div class="col-sm-3">
                        Out-of-Hours 
                    </div>
                    <div class="col-sm-3">
                         <label><input id="outofhourscheck" name="outofhours" class="ace ace-switch ace-switch-5 btn-rotate" type="checkbox" <%= @userprofile.outofhours.to_s == "true" ? "checked" : "unchecked" %> /><span class="lbl"></span></label>  <span class="tooltip-success" data-rel="tooltip" data-placement="right" title="Some jobs require you to work outside of operating hours. Would you take up such jobs?"><i class="icon-info-sign"></i></span>
                    </div>
                    <div class="col-sm-6"> </div>
                  </div>

                  <br>
        </div>
        <div id="t4" class="tab-pane">  
                  <div class="row">  

                    <div class="col-sm-10">
                        <p class="header smaller lighter blue">Please select your preferred industries </p>
                    </div>
                  </div>
                  <div class="row ">
                    <div class="col-sm-10">
                        <a href="#" id="industries" data-type="select2" data-value="<%= @pref_ind %>"  data-pk="<%=@userprofile.id %>" data-url="/updateindpref" data-title="Enter preferred industries"></a>
                    </div>
                  </div>
        </div>
        <div id="loc" class="tab-pane"> 
                  <div class="row">
                    
                    <div class="col-sm-5">
                        <p class="header smaller lighter blue">Please select your preferred locations</p>
                    </div>
                  </div>
                  <div class="row ">
                     <div class="col-sm-5"> 
                         <a href="#" id="locations" data-type="select2" data-value="<%= @pref_loc %>"  data-pk="<%=@userprofile.id %>" data-url="/updatelocpref" data-title="Enter preferred locations"></a>
                    </div>
                  </div>
        </div>

        <div id="t5" class="tab-pane">   
              <div class="row">
                  <div class="col-sm-12">
                    <p class="lighter blue">Please key in your current and expected annual salary in Singapore Dollar </p>
                  </div>
              </div>
              <div class="row">  <!-- 5th row in the Preference Management section --> 
                 <div class="col-sm-12">  
                    <div class="form-group">
                        Current annual salary: S$ <a href="#" id="currentsalary" data-name="currentsalary" data-type="text" data-pk="<%=@userprofile.id %>" data-url="/updateprofile" data-title="Enter current salary"><%= @userprofile.currentsalary %></a>
                    </div>
                    <div class="form-group">
                        Expected annual salary: S$ <a href="#" id="expectedsalary" data-name="expectedsalary" data-type="text"  data-pk="<%=@userprofile.id %>" data-url="/updateprofile" data-title="Enter expected salary"><%= @userprofile.expectedsalary %></a>
                    </div>
                </div>
              </div>
        </div>
        <div id="t6" class="tab-pane">
              <div class="row">  <!-- 5th row in the Preference Management section --> 
                  
                 
                <div class="col-sm-6">  
                 
                        Preferred Travel Frequency %: <label><input type="text" class="input-mini" id="spinner2" value="<%=@userprofile.travelfreq %>" /></label>      
                 
                </div>
              </div>      
        </div>
        <div id="skilltab" class="tab-pane">
              <div class="row">  
                <div class="col-sm-12 col-lg-12 ">
                <h3 class="header smaller lighter blue">Skills Management</h3>
                <div id="skilltable">
                    <div class="action-buttons"><a class="red" href="#addskillmodal" data-toggle="modal" data-keyboard="false" data-backdrop="static"> <i class="icon-pencil bigger-130">Add a skill</i></a></div> 
                  <div id="st">
                    <table id="skillsettingtable" class="table table-striped table-bordered table-hover">
                        <thead>
                          <tr>
                             <th >Category</th>
                             <th >Skill Name</th>
                             <th colspan="2" >Skill Rank</th>
                             <!-- <th class="align-center"></th> -->
                          </tr>
                        </thead>
                        <tbody id="aat" >
                            <% @allskills.each do |i| %>  <!--From Skill Summary Class -->
                            <!-- If flag is set to delete, break. and find next record -->
                            <% if @allskills.get(i).status != 0 %>
                         
                            <tr>
                               <td><%= @scmaster.get(i.skillcatid).categoryname %></td>
                               <td><%= @ssmaster.get(i.skillid).skill_name %> </td>
                               <td><a class="skillrank" href="javascript:void(0)" class="editable-click" data-name="skillrank" data-type="select" data-pk="<%= @allskills.get(i).id%>" data-url="/updateskillrank" data-source="[{value: 1, text: 'Basic'}, {value: 2, text: 'Intermediate'}, {value: 3, text: 'Advance'}, {value: 4, text: 'Expert'}]"   data-title="Enter skill rank">  <%= @sr.get(i.skillrank).skillrankname %>
                               </a></td>                   
                               <td>
                                <div class="hidden-sm hidden-xs action-buttons">
                                    <a onclick="delskill(this, <%=i.id%>)" class="red" href="javascript:void(0)"> <i class="fa fa-trash"></i></a>               
                                </div>
                               </td>
                            </tr>
                           <% end %>
                           <% end %>
                        </tbody>
                      </table>
                    </div> <!-- id="st"-->
                  <br><br>
                </div> <!-- skilltable" -->
                </div> <!-- "col-sm-6 column" -->                
              </div>    <!-- row -->  
        </div> <!-- skilltab -->

        <div id="languagetab" class="tab-pane">
              <div class="row">  
                  <div class="col-sm-12">
                    <h3 class="header smaller lighter blue">Languages</h3>
                    <div id="skilltable">
                      <div class="action-buttons">
                          <a class="red" href="#addlanguagemodal" data-toggle="modal"> <!-- Set a flag to say it is deleted.  -->
                            <i class="icon-pencil bigger-130">Add a language</i>
                          </a>
                          <a class="red" href="#addlanguagemodal" data-toggle="modal"> <!-- Set a flag to say it is deleted.  -->
                            <i class="icon-pencil bigger-130">Report new language</i>
                          </a>
                      </div>        
                      <table id="languagesettingtable" class="table table-striped table-bordered table-hover">
                          <thead>
                            <tr>
                               <th class="align-center">Language</th>
                               <th class="align-center">Written Proficiency</th>
                               <th class="align-center">Spoken Proficiency</th>
                               <th class="align-center"></th>
                            </tr>
                          </thead>
                          <tbody>
                              <% @languages.each do |i| %>
                              <% if @languages.get(i).status != 0 %>
                              <tr>
                                 <td><a class="languagename" href="javascript:void(0)" class="editable-click" data-name="languageid" data-type="text" data-pk="<%= @languages.get(i).id%>" data-url="/update_language"  data-title="Enter skill category "><%= @lmaster.get(languageid).languagename %></a></td>
                                
                                <td><a class="writtenrank" href="javascript:void(0)" class="editable-click" data-name="writtenrank" data-type="select" data-pk="<%= @languages.get(i).id%>" data-url="/update_language" data-source="[{value: 1, text: 'Basic'}, {value: 2, text: 'Intermediate'}, {value: 3, text: 'Advance'}, {value: 4, text: 'Expert'}]"   data-title="Enter skill rank">  <%= @sr.get(i.writtenrank).skillrankname %>
                                 </a></td>
                               
                                 <td><a class="spokenrank" href="javascript:void(0)" class="editable-click" data-name="spokenrank" data-type="select" data-pk="<%= @languages.get(i).id%>" data-url="/update_language" data-source="[{value: 1, text: 'Basic'}, {value: 2, text: 'Intermediate'}, {value: 3, text: 'Advance'}, {value: 4, text: 'Expert'}]"   data-title="Enter skill rank">  <%= @sr.get(i.spokenrank).skillrankname %>
                                 </a></td>
                                 <td>
                                <div class="hidden-sm hidden-xs action-buttons">
                                      <a onclick="del_language(this, <%=i.id%>)" class="red" href="javascript:void(0)">
                                        <i class="icon-trash bigger-130"></i>                                     
                                      </a>
                                  </div>
                                 </td>
                              </tr>
                             <% end %>
                              <% end %>
                          </tbody>
                        </table>
                  </div> <!-- skill table -->
                </div> <!-- "col-sm-6 column" -->
              </div>    <!-- row -->  
        </div>     <!-- language tab -->

        <div id="t7" class="tab-pane">
                 <div class="row">
                  <div class="col-sm-6">
                      Your current CV in our file: <span id="CVsection"> <a href=<%= @userprofile.cvurl %>>HERE</a></span>
                      <br><br>
                      <script src='/vendor/jqueryfileupload/js/vendor/jquery.ui.widget.js' type='text/javascript'></script>
                      <script src='/vendor/jqueryfileupload/js/jquery.iframe-transport.js' type='text/javascript'></script>
                      <script src='/vendor/jqueryfileupload/js/jquery.fileupload.js' type='text/javascript'></script>
                      <script src='/vendor/jqueryfileupload/js/jquery.fileupload-process.js' type='text/javascript'></script>
                      <script src='/vendor/jqueryfileupload/js/jquery.fileupload-validate.js' type='text/javascript'></script>
                      <script src='/vendor/cloudinary/jquery.cloudinary.js' type='text/javascript'></script>
                      <script type="text/javascript">
                          $.cloudinary.config({cloud_name:'dashy', api_key:'219441847515364'});
                      </script> 

                        <span class="btn btn-success fileinput-button">
                        <i class="glyphicon glyphicon-plus"></i>
                            <span>Update CV</span>
                        <input name="file" type="file" id="fileupload" class="cloudinary-fileupload" data-cloudinary-field="image_upload" data-form-data="">
                        </span>
                      <div id="CVsection"> </div>
                      <script type="text/javascript">
                          $.ajax({
                                  url: '/filer',
                                  type: 'POST',
                                  success: function(response){  
                                        $('#fileupload').attr('data-form-data', response);
                                  }
                                });
                         
                          $('.cloudinary-fileupload').bind('cloudinarydone', function(e, data) {  
                            // $('.preview').html(
                            //        $.cloudinary.image(data.result.public_id, 
                            //            { format: data.result.format, version: data.result.version, 
                            //              crop: 'scale', width: 200 }));    
                            //        $('.image_public_id').val(data.result.public_id);   
                            // If data.result.format is not .doc or .docx, reject.
                                   $.ajax({
                                        url: '/cvuploaded',
                                        type: 'POST',
                                        data: {"cvurl": data.result.url, "pk" : <%=@userprofile.id %>},
                                        success: function(response){
                                          tt= "<a href=".concat(data.result.url,">MyCV</a>");
                                          $('#CVsection').html(tt);
                                          newAlert("#alert_placeholder-tab", 'success', "File uploaded successfully!");
                                           
                                        }
                                               

                                   }); //ajax
                                   return true;
                          }); //cloudinary done
                      </script> 
                  </div>
                 </div>
        </div>   <!-- t7 -->    
      </div> <!-- <div class="tab-content">-->
      </div> <!--<div class="tabbable"> -->        
    </div> <!-- <div class="col-xs-6 col-md-10 col-lg10">-->
    <div class="col-md-2 col-lg-2"></div>
      
   </div> <!--Content Wrapper-->           
                    
  